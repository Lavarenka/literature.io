{% extends "base.html" %}
{% load static %}
{% load genre %}

{% block title %}{{ title }} {% endblock %}


{% block content %}

    <!-- ### Хлебные крошки  жанры ### -->
    <div class="d-flex  mb-2 box_lvl p-1 index_breadcrumb d-none d-xl-block">
        <nav aria-label="">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="{% url 'home' %}">Главная</a></li>

                {% if post.series %}
                    <li class="breadcrumb-item"><a href="{{ post.series.get_absolute_url }}">{{ post.series }}</a></li>
                {% endif %}

                {% comment %}
                    {% for g in post.genre.all %}
                        <li class="breadcrumb-item"><a href="{{ g.get_absolute_url }}">{{ g.title }}</a></li>

                    {% endfor %}
                {% endcomment %}



                <li class="breadcrumb-item">{{ post.title }}</li>
            </ol>
        </nav>
    </div>

    <!-- # жанры канвас # -->
    {% include 'inc/_genre_canvas.html' %}
    <!-- # /жанры канвас # -->

    <!-- ### /Хлебные крошки  жанры ### -->

    <!-- ### main_content ### -->
    <div class="main_content  box_lvl p-1 mb-2">
        <div class="main_content_container p-1 ">
            <div class="container container_details">
                <div class="row row_details ">
                    <div class="details_title text-center p-2">{{ post.title }}</div>
                    <hr>
                    <div class="top__details d-flex row my-2">


                        {% if post.photo_post %}
                            <div class="img__details col-sm-3 d-flex "><img
                                    src="{{ post.photo_post.url }}" alt=""></div>
                        {% else %}
                            <div class="img__details col-sm-3 d-flex "><img
                                    src="{% static 'img/no_product.jpg' %}" alt=""></div>
                        {% endif %}

                        <div class="description__details col p-2 d-flex flex-column ">
                            <div class="d-flex flex-column description_top__details">

                                <p>
                                    Жанр:

                                    {% for g in post.genre.all %}

                                        <a href="{{ g.get_absolute_url }}">{{ g.title }}</a>
                                    {% endfor %}

                                </p>
                                {% if post.series %}
                                    <p>Серия: <a href="{{ post.series.get_absolute_url }}">{{ post.series }}</a></p>
                                {% endif %}


                                <p>Номер книги в серии: {{ post.number_series }}</p>
                                <p>Автор: <a href="{{ post.author.get_absolute_url }}">{{ post.author }}</a></p>
                                <p>Год: {{ post.year }}</p>
                            </div>

                            <div class="d-flex align-items-center justify-content-around ">
                                <div class="pe-3"><i class="fa-regular fa-clock"></i>
                                    {{ post.time_create|date:"d-m-Y H:i" }}
                                </div>
                                <div class="pe-3"><i class="fa-regular fa-clock"></i>
                                    {{ post.time_create|timesince }}
                                    {#  timesince  Сколько прошло времени от создания   #}
                                </div>
                                <div class="pe-3"><i class="fa-solid fa-eye"></i> {{ post.views }}</div>
                                <div class="pe-3"><i class="fa-regular fa-comment-dots"></i> {{ post.comment.all.count }}</div>

{#                                    <div class="rating-area ">#}
{##}
{#                                        <input type="radio" id="star-5" name="rating" value="5">#}
{#                                        <label for="star-5" title="Оценка «5»"></label>#}
{#                                        <input type="radio" id="star-4" name="rating" value="4">#}
{#                                        <label for="star-4" title="Оценка «4»"></label>#}
{#                                        <input type="radio" id="star-3" name="rating" value="3">#}
{#                                        <label for="star-3" title="Оценка «3»"></label>#}
{#                                        <input type="radio" id="star-2" name="rating" value="2">#}
{#                                        <label for="star-2" title="Оценка «2»"></label>#}
{#                                        <input type="radio" id="star-1" name="rating" value="1">#}
{#                                        <label for="star-1" title="Оценка «1»"></label>#}
{##}
{#                                    </div>#}
                                    <div class="">
                                        <form action="{% url "add_rating" %}" method="post" name="rating">
                                            {% csrf_token %}
                                            <input type="hidden" value="{{ post.id }}" name="post">
                                            <span class="rating">
                                                {% for k, v in star_form.fields.star.choices %}
                                                    <input  id="rating{{ v }}" type="radio" name="star", value="{{ k }}">
                                                    <label   for="rating{{ v }}">{{ k }}</label>
                                                {% endfor %}

                                            </span>
                                            <span class="editContent">{{ mid }}</span>
                                        </form>
                                    </div>




                            </div>
                        </div>
                    </div>



                    <div class="text-center details_title">Описание</div>
                    <hr>
                    <div class="header__details p-2">
                        {{ post.content|safe }}
                    </div>
                    <div class="  text-end mb-3">
                        <button type="button" class="btn btn-primary  ">Скачать fb-2</button>
                    </div>
                    <hr class="">
                    <div class="mb-2">Остальные книги серии:</div>
                    <hr class="">
                    <div class="">S.T.A.L.K.E.R. 01. Тумановский Ежи и
                        Дядищев Александр
                        - Тени Чернобыля. Клык:
                    </div>

                    <hr>

                    {% if user.is_authenticated %}

                        <div class="m-2">
                            <form action="{% url 'create_comment' pk=post.id %}" method="post">

                                {% csrf_token %}

                                <div class="mb-3">
                                    <label for="{{ form.content.id_for_label }}" class="form-label">Оставить
                                        комментарий</label>
                                    {{ form.content }}
                                    <div class="invalid-feedback">
                                        {{ form.content.errors }}
                                    </div>
                                </div>

                                {{ form.non_field_errors }}
                                {#        общие ошибки      #}

                                <button type="submit" class="btn btn-primary btn-block">Отправить</button>
                            </form>
                        </div>

                    {% else %}
                        <div class="m-2">Для добавления комментария , <a
                                href="{% url 'users:login' %}">Авторизуйтесь</a></div>
                    {% endif %}

                    <div class="">Комментарии:</div>
                    <hr>
                    {% if post.comment.all %}
                        {% for com in post.comment.all %}
                            <div class="card mb-2 ">
                                <div class="card-header">
                                    {{ com.author.username|default:"Пользователь удален" }}
                                </div>
                                <div class="card-body">
                                    <blockquote class="blockquote mb-0">
                                        <p>{{ com.content }}</p>
                                    </blockquote>
                                </div>
                                <hr>
                                <div class="d-flex justify-content-between">
                                    <div class="text-end mb-1">{{ com.time_create }}</div>
                                    {% if com.author.id == user.id %}
                                        <div class="">
                                            <!-- Button trigger modal -->
                                            <button type="button" class="btn btn-primary" data-bs-toggle="modal"
                                                    data-bs-target="#staticBackdrop">
                                                Удалить
                                            </button>

                                            <!-- Modal -->
                                            <div class="modal fade" id="staticBackdrop" data-bs-backdrop="static"
                                                 data-bs-keyboard="false" tabindex="-1"
                                                 aria-labelledby="staticBackdropLabel"
                                                 aria-hidden="true">
                                                <div class="modal-dialog">
                                                    <div class="modal-content">
                                                        <div class="modal-header">

                                                            <button type="button" class="btn-close"
                                                                    data-bs-dismiss="modal"
                                                                    aria-label="Close"></button>
                                                        </div>
                                                        <div class="modal-body">
                                                            <p>Удалить комментарий ?</p>
                                                        </div>
                                                        <div class="modal-footer">
                                                            <button type="button" class="btn btn-secondary"
                                                                    data-bs-dismiss="modal">Close
                                                            </button>
                                                            <button type="button" class="btn btn-primary"><a
                                                                    href="{% url 'delete_comment' com.pk %}">Delete</a>
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>




                                    {% endif %}

                                </div>

                            </div>
                        {% endfor %}
                    {% else %}
                        <div class="">Нет комментариев</div>
                    {% endif %}


                </div>
            </div>


        </div>
    </div>
    <!-- ### /main_content ### -->

{% endblock content %}





